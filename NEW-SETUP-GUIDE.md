# Claude Code 自动审批系统 - 统一设置工具指南

## 🆕 新功能介绍

我们全新的统一设置工具 `setup-v2.sh` 将原来的多个脚本功能整合为一个智能化的安装体验，提供：

- 🧠 **智能项目检测** - 自动识别Node.js、Python、Java等项目类型
- 🎯 **智能环境推荐** - 根据项目特点推荐最适合的审批策略
- 🔧 **三种安装方式** - 全局、用户级、项目级安装，满足不同需求
- ⚡ **一键快速部署** - 支持命令行快速设置
- 📊 **状态管理** - 随时查看配置状态

## 🚀 快速开始（推荐交互式模式）

### 1. 运行交互式设置
```bash
./setup-v2.sh
```

### 2. 按照向导选择
- **安装方式**：推荐选择"用户级安装"
- **环境类型**：推荐选择"智能审批"或"自动检测"
- **项目路径**：（如果选择项目级安装）

### 3. 完成安装
系统会自动完成所有配置并运行测试验证

## 📋 详细安装方式对比

| 安装方式 | 适用范围 | 权限要求 | 适用场景 |
|----------|----------|----------|----------|
| **全局安装** | 系统所有用户 | 管理员权限 | 服务器、共享开发环境 |
| **用户级安装** ⭐ | 当前用户 | 普通用户权限 | 个人电脑、开发机（推荐） |
| **项目级安装** | 特定项目 | 普通用户权限 | 特殊项目、需要不同策略 |

## 🔧 环境类型选择指南

| 环境类型 | 安全级别 | 适用场景 | 特点说明 |
|----------|----------|----------|----------|
| **自动检测** ⭐ | 智能适配 | 通用推荐 | 自动识别项目类型并应用最佳策略 |
| **基础审批** | 低 | 新手入门 | 简单安全控制，容易理解 |
| **开发环境** ⭐ | 中低 | 日常开发 | 支持开发工具，相对宽松 |
| **生产环境** | 高 | 服务器部署 | 严格安全控制，只允许安全操作 |
| **CI/CD环境** | 中 | 自动化流水线 | 自动化优先，基础安全检查 |
| **智能审批** ⭐ | 中高 | 通用推荐 | 上下文感知，智能决策 |
| **组合智能** | 最高 | 高级用户 | 多因素综合评分，最智能 |

## ⚡ 快速部署命令

### 最常用的部署组合
```bash
# 用户级智能审批（推荐个人使用）
./setup-v2.sh -q -e smart -m user

# 项目级开发环境（推荐新项目）
./setup-v2.sh -e dev -m project -p ~/my-new-project

# 全局自动检测（推荐服务器）
./setup-v2.sh -e auto -m global

# 生产环境（服务器部署）
./setup-v2.sh -e prod -m global
```

### 快速模式参数说明
- `-q, --quick` - 快速模式，跳过交互
- `-e, --env <类型>` - 指定环境类型
- `-m, --method <方式>` - 指定安装方式
- `-p, --project <路径>` - 指定项目路径（项目级安装时）

## 🎯 不同场景的推荐配置

### 场景1：个人开发
```bash
# 推荐：用户级 + 智能审批
./setup-v2.sh -q -e smart -m user
```
- ✅ 适合日常开发工作
- ✅ 支持常见开发工具
- ✅ 智能上下文感知

### 场景2：新项目初始化
```bash
# 推荐：项目级 + 自动检测
./setup-v2.sh -e auto -m project -p ~/my-new-project
```
- ✅ 自动识别项目类型
- ✅ 应用最适合的策略
- ✅ 项目独立配置

### 场景3：团队协作服务器
```bash
# 推荐：全局 + 智能审批
./setup-v2.sh -e smart -m global
```
- ✅ 所有项目统一标准
- ✅ 智能适应不同项目
- ✅ 便于统一管理

### 场景4：生产服务器
```bash
# 推荐：全局 + 生产环境
./setup-v2.sh -e prod -m global
```
- ✅ 最高安全级别
- ✅ 严格访问控制
- ✅ 详细审计日志

## 🔍 状态查看和管理

### 查看当前配置状态
```bash
./setup-v2.sh -s
```

### 检查系统依赖
```bash
# 在安装前检查依赖
./setup-v2.sh -c
```

## 🧪 安装后验证

### 基础功能测试
```bash
# 测试基础命令（应该自动批准）
echo '{"tool_name": "ls", "tool_input": {"path": "/tmp"}, "context": {"project_root": "/tmp"}}' | bash $(grep -o '"command": *"[^"]*"' ~/.claude/settings.json | cut -d'"' -f4)

# 测试危险命令（应该被拒绝）
echo '{"tool_name": "Bash", "tool_input": {"command": "rm -rf /"}, "context": {"project_root": "/tmp"}}' | bash $(grep -o '"command": *"[^"]*"' ~/.claude/settings.json | cut -d'"' -f4)
```

### 运行完整测试套件
```bash
./testing/test-approval-scripts.sh
```

## 🛠️ 高级用法

### 多环境管理
```bash
# 为不同项目设置不同环境
./setup-v2.sh -e dev -m project -p ~/dev-project
./setup-v2.sh -e prod -m project -p ~/prod-project
```

### 自动化部署脚本
```bash
#!/bin/bash
# 批量项目初始化脚本

projects=("project1" "project2" "project3")
for project in "${projects[@]}"; do
    ./setup-v2.sh -e auto -m project -p "~/workspace/$project"
done
```

## 🚨 注意事项

### 权限要求
- **全局安装**: 需要管理员权限（sudo）
- **用户级安装**: 普通用户权限即可
- **项目级安装**: 普通用户权限即可

### 环境冲突
- 项目级配置会覆盖用户级配置
- 用户级配置会覆盖全局配置
- 建议：全局设置基础策略，项目级设置特殊需求

### 安全最佳实践
1. **生产环境**务必使用严格的安全策略
2. **定期审查**审批日志和配置
3. **测试验证**每个新配置
4. **备份重要**配置变更

## 📚 相关文档

- **[完整使用指南](USAGE-GUIDE.md)** - 详细的部署和使用说明
- **[快速开始指南](QUICK-START.md)** - 1分钟上手教程
- **[脚本功能清单](SCRIPT-LIST.md)** - 所有脚本详细说明
- **[测试和调试工具](testing/)** - 验证和故障排除工具

## 💡 最佳实践建议

### 个人用户推荐流程
1. **首次使用**: 运行 `./setup-v2.sh` 选择交互式设置
2. **日常开发**: 使用用户级 + 智能审批
3. **新项目**: 使用项目级 + 自动检测
4. **定期维护**: 运行测试验证功能

### 团队推荐流程
1. **统一标准**: 使用全局 + 智能审批作为基础
2. **特殊项目**: 使用项目级覆盖特殊需求
3. **环境管理**: 建立标准化的环境切换流程
4. **培训文档**: 为团队成员提供使用指南

## 🎉 总结

新的统一设置工具 `setup-v2.sh` 让 Claude Code 自动审批系统的部署变得前所未有的简单：

- ✅ **一个脚本**完成所有设置
- ✅ **智能推荐**最适合的配置
- ✅ **多种方式**满足不同需求
- ✅ **快速部署**支持命令行操作
- ✅ **完整工具链**包含测试和调试

**从复杂的手动配置到智能化的一键部署**，这就是现代开发工具应有的体验！

---

**立即开始使用:** `./setup-v2.sh`

享受智能化开发审批带来的效率提升！ 🚀✨

---

*记住：好的工具让开发更快乐，智能审批让代码更安全！* 😊🎯

## 📞 获得帮助

- **查看日志**: `tail -f /tmp/claude-approval.log`
- **运行测试**: `./testing/test-approval-scripts.sh`
- **调试工具**: `./testing/debug-approval-script.sh -h`
- **查看文档**: `cat README.md`
- **提交反馈**: GitHub Issues

**Happy coding with intelligent approval!** 🎊✨

---

*最后更新: $(date)*
*版本: v2.0*
*统一设置工具: setup-v2.sh*